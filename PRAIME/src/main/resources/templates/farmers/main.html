<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>농담</title>
<link th:href="@{/css/font.css}" rel="stylesheet">
<link th:href="@{/css/common.css}" rel="stylesheet">
<link th:href="@{/css/farmers/main.css}" rel="stylesheet"> <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script th:src="@{/js/common.js}"></script>
<script th:src="@{/js/farmers/main.js}"></script> <link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
	<div class="container">
		<div class="wrapper">
			<header>
				<div class="header-group">
					<div class="header-title-group">
						<h1 th:text="${session.user.name} + ' 님'" class="header-title">SuperNova
							님</h1>
						<p class="header-subtitle">오늘도 좋은하루 되세요</p>
					</div>
					<div class="today-group">
						<span class="today">2025년 6월 17일</span> </div>
				</div>
			</header>
			<main>
				<div class="main-wrap">
					<section class="weather-section">
						<div class="weather-box">
							<div class="weather-top-section"> <div class="weather-left">
									<h1 class="weather-title">오늘의 날씨</h1>
								</div>
								<div class="weather-right-header"> <div class="weather-tasks-title">특보</div>
									<div class="weather-tasks" id="weatherWarning">특이사항 없음</div>
								</div>
							</div>
							
							<div class="weather-middle-section"> 
								<div class="weather-info">
									<div class="weather-icon">
										<img id="weatherIcon" src="" alt="날씨 아이콘"> 
									</div>
									<div class="weather-detail">
										<div class="temperature" id="temperature"></div>
										<div class="humidity" id="humidity"></div>
										<div class="rainfall" id="rainfall"></div>
										<div class="wind" id="wind"></div>
									</div>
								</div>
							</div>

							<hr class="divider2"/>
							
							<div class="weather-bottom-section"> <div class="weather-location">광주시 충장동 기준</div>
								<div class="weather-update-time" id="updateTime"></div>
							</div>
						</div>
					</section>
					
					
					<section class="core-func-section">
						<div class="core-title">핵심 기능</div>
						<div class="core-card-group">
							<div class="core-card" onclick="goToFarmlogWritePage()">
								<img th:src="@{/img/writeFarmLog.png}" alt="작업 일지" class="core-icon">
								<span class="core-label">영농일지</span>
							</div>
							<div class="core-card" onclick="goToDiagnosisUploadPage()">
								<img th:src="@{/img/objectDetecting.png}" alt="병해충 진단" class="core-icon">
								<span class="core-label">병해충 진단</span>
							</div>
						</div>
					</section>
					
					<hr class="divider" />
					
					
					<section class="recent-journal-section">
						<div class="section-header">
							<h2 class="section-title">최근 일지</h2>
							<a href="/farmlogBoardPage" class="view-all">전체보기 &gt;</a>
						</div>

						<div class="journal-list">
							<div th:if="${#lists.isEmpty(recentLogs)}" class="no-journal">
								등록된 영농일지가 없습니다.
							</div>
							<div th:each="log : ${recentLogs}" class="journal-item" th:onclick="'location.href=\'/farmlog/view/' + ${log.dlid} + '\''">
								<div class="journal-date" th:text="${#temporals.format(log.dldate, 'MM.dd')}">날짜</div>
								<div class="journal-content">
									<div class="journal-title" th:text="${log.dltitle}">제목</div>
									<div class="journal-desc" th:text="${log.dlcontent}">내용</div>
									<div class="journal-meta">
										<span class="journal-crop" th:text="${log.dlcrop}">작물</span>
										<span class="journal-weather" th:text="${log.dlweather}">날씨</span>
										<span class="journal-temp" th:if="${log.dltemp != null}" th:text="${log.dltemp + '°C'}">온도</span>
									</div>
								</div>
							</div>
							</div>

						<div class="journal-add-button">
							<button class="add-journal-btn" onclick="goToFarmlogWritePage()">+
								새 영농일지 작성하기</button>
						</div>
					</section>
					
					<hr class="divider" />
					
					
                    <section class="recent-diagnosis-section">
                        <div class="section-header">
                            <h2 class="section-title">최근 진단 이력</h2>
                            <a href="/diagnosisBoardPage" class="view-all">전체보기 &gt;</a>
                        </div>
                    
                        <div class="journal-list">
                            <div th:if="${#lists.isEmpty(diagnosisList)}" class="no-records">
                                진단 기록이 없습니다.
                            </div>
                            <div class="journal-item"
                                 th:each="diagnosis : ${diagnosisList}"
                                 data-toggle="modal"                          
                                 data-target="#imageModal"                    
                                 th:data-image-src="${diagnosis.imagePath}"   
                                 th:data-label="${diagnosis.label}"           
                                 th:data-confidence="${#numbers.formatDecimal(diagnosis.confidence, 0, 'POINT', 0, 'POINT')} + '%'" 
                                 th:data-description="${diagnosis.description}" 
                            >
                                <div class="journal-date" 
                                     th:text="${#temporals.format(diagnosis.createdAt, 'MM.dd').equals(#temporals.format(#temporals.createNow(), 'MM.dd'))} ? '오늘' : ${#temporals.format(diagnosis.createdAt, 'yy.MM.dd')}">
                                     </div>
                                <div class="journal-content">
                                    <div class="journal-image-thumbnail">
                                        <img th:src="@{${diagnosis.imagePath}}" th:alt="${diagnosis.label} + ' 진단 이미지'">
                                    </div>
                                    <div class="journal-text-content"> 
                                        <div class="journal-title" th:text="${diagnosis.label}"></div>
                                        <div class="journal-desc">
                                            신뢰도: <span th:text="${#numbers.formatDecimal(diagnosis.confidence, 0, 'COMMA', 0, 'POINT')} + '%'"></span>
                                            <div class="card-bar" th:styleappend="'--confidence-width: ' + ${#numbers.formatDecimal(diagnosis.confidence, 0, 0)} + '%'"></div>
                                            <div class="info-mgs">신뢰도는 단순히 AI모델이 업로드한 이미지의 결과를 판단한 결과로 단순히 참고용입니다</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    
                        <div class="journal-add-button">
                            <button class="add-journal-btn" onclick="goToDiagnosisUploadPage()">+ 병해충 진단 하기</button>
                        </div>
                    </section>
					
				</div>
			</main>
			<div th:replace="/global/footer::footer "></div>
		</div>
	</div>
<div id="imageModal" class="modal">
    <div class="modal-content-wrapper"> 
        <span class="close-button">&times;</span>
        <img class="modal-content" id="modalImage" alt="진단 이미지">
        <div class="modal-info"> 
            <p class="modal-label" id="modalLabel"></p>
            <p class="modal-confidence" id="modalConfidence"></p>
            <p class="modal-description" id="modalDescription"></p>
            <hr class="divider">
            <div class="info-mgs">신뢰도는 단순히 AI모델이 업로드한 이미지의 결과를 판단한 결과로 단순히 참고용입니다</div>
        </div>
    </div>
</div>	
</body>
</html>