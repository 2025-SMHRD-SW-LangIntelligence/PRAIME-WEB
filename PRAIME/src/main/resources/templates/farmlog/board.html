<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link th:href="@{/css/font.css}" rel="stylesheet">
    <link th:href="@{/css/common.css}" rel="stylesheet">
    <link th:href="@{/css/farmlog/board.css}" rel="stylesheet">
	<!-- Font Awesome CDN 추가 -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
   	<!-- jQuery CDN  -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <!-- Axios CDN  -->
   	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- 파일   -->
    <script th:src="@{/js/common.js}"></script>
    <script th:src="@{/js/farmlog/board.js}"></script>
    <title>영농일지 페이지</title>
</head>
<body>
    <div class="container">
		<div class = "wrapper">
		<header>
            <div class="header-group">
            	<div>
            		<a href="#" class="prevPage" onclick = "history.back()"> < </a>
            	</div>
                <div class="header-title-group">
                	<span class = "header-title">영농일지</span>
                	<button class = "new-diary-btn" onclick = "location.href = '/farmlogWritePage'">새 일지 작성</button>
                </div>
            </div>
        </header>
        <main>
	        <section class = "search-section">
		        <div class = "search-board">
			        <form action = "/farmlogBoardPage" method = "get" class = "search-form">
			        	<input type = "text" class = "search-input" name = "keyword" id = "keyword" 
			        		   placeholder = "일지 검색" th:value="${keyword}">
			        	
			        		<select class = "search-select" name = "searchOption" id = "searchOption">
			        			<option value = "title" th:selected="${searchOption == 'title'}">제목</option>
			        			<option value = "content" th:selected="${searchOption == 'content'}">내용</option>        			
			        			<option value = "crop" th:selected="${searchOption == 'crop'}">작물</option>       			
			        			<option value = "weather" th:selected="${searchOption == 'weather'}">날씨</option>       			
			        		</select>
			        	<button type = "submit" class="btn btn-primary">검색</button>
			        </form>
		        </div>
	        </section>
	        
	        <!-- 정렬 버튼 추가 -->
	        <section class="sort-section">
	            <div class="sort-buttons">
	                <button id="sort-toggle-button">
	                    <i class="fas fa-sort-amount-down-alt"></i> 최신순
	                </button>
	            </div>
	        </section>
	        
	        <section class = "board-section">
	        	<div class = "board-list" id="board-list">
	        		<!-- Thymeleaf를 사용한 실제 DB 데이터 표시 -->
	        		<div th:each="log : ${boardList}" class="board-card" th:attr="onclick=|location.href='/farmlog/view/${log.dlid}'|">
						<div class="board-card-image">
	        				<img th:if="${not #lists.isEmpty(log.dlimage)}" 
	        					th:src="@{'uploads/farmlog/' + ${log.dlimage[0].dlipath}}" 
	        					alt="영농일지 이미지" class="card-thumbnail">
	        				<img th:if="${#lists.isEmpty(log.dlimage)}" 
	        					th:src="@{/img/log.png}" 
	        					alt="기본 이미지" class="card-thumbnail">
	        			</div>
	        			<div class="board-card-content-wrapper">
	        				<div class="board-card-title" th:text="${log.dltitle}">제목</div>
	        				<div class="board-card-content" th:text="${log.dlcontent}">내용</div>
	        				<div class="board-card-meta">
	        					<span class="board-card-crop" th:text="${log.dlcrop}">작물</span>
	        					<span class="board-card-weather" th:text="${log.dlweather}">날씨</span>
	        					<span class="board-card-temp" th:if="${log.dltemp != null}" th:text="${log.dltemp + '°C'}">온도</span>
	        					<span class="board-card-date" th:text="${#temporals.format(log.dldate, 'yyyy년 MM월 dd일')}">날짜</span>
	        				</div>
	        			</div>
	        		</div>
	        		
	        		<!-- 데이터가 없을 때 표시할 메시지 -->
	        		<div th:if="${#lists.isEmpty(boardList)}" class="no-result">
	        			<span th:if="${keyword != null and keyword != ''}">
	        				'<span th:text="${keyword}"></span>'에 대한 검색 결과가 없습니다.
	        			</span>
	        			<span th:unless="${keyword != null and keyword != ''}">
	        				등록된 영농일지가 없습니다.
	        			</span>
	        		</div>
	        	</div>
	        </section>
        </main>
        <!-- Footer -->
        <div th:replace="/global/footer::footer "></div> 
		</div>
    </div>
    
    <!-- 무한스크롤을 위한 fragment -->
    <div th:fragment="board-list">
        <div th:each="log : ${farmlogList}" class="board-card" 
             th:onclick="'location.href=\'/farmlog/view/' + ${log.dlid} + '\''"
             th:data-dlid="${log.dlid}"
             th:data-title="${log.dltitle}"
             th:data-content="${log.dlcontent}"
             th:data-crop="${log.dlcrop}"
             th:data-weather="${log.dlweather}"
             th:data-temp="${log.dltemp}"
             th:data-date="${#temporals.format(log.dldate, 'yyyy-MM-dd')}">
            <div class="board-card-image">
                <img th:if="${not #lists.isEmpty(log.dlimage)}" 
                    th:src="@{'/uploads/farmlog/' + ${log.dlimage[0].dlipath}}" 
                    alt="영농일지 이미지" class="card-thumbnail">
                <img th:if="${#lists.isEmpty(log.dlimage)}" 
                    th:src="@{/img/log.png}" 
                    alt="기본 이미지" class="card-thumbnail">
            </div>
            <div class="board-card-content-wrapper">
                <div class="board-card-title" th:text="${log.dltitle}">제목</div>
                <div class="board-card-content" th:text="${log.dlcontent}">내용</div>
                <div class="board-card-meta">
                    <span class="board-card-crop" th:text="${log.dlcrop}">작물</span>
                    <span class="board-card-weather" th:text="${log.dlweather}">날씨</span>
                    <span class="board-card-temp" th:if="${log.dltemp != null}" th:text="${log.dltemp + '°C'}">온도</span>
            <span class="board-card-date" th:text="${#temporals.format(log.dldate, 'yyyy년 MM월 dd일 HH:mm')}">날짜</span>
                </div>
            </div>
		</div>
    </div>
</body>
</html>